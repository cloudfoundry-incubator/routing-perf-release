#!/bin/bash -l

set -e

DIR=`dirname $0`

<% p("performance_tests.routers").each do |router| %>
  ${DIR}/run_perf_test <%= router["address"] %> <%= router["tag"] %> &
  PIDS="${PIDS} $!"
<% end %>

for PID in ${PIDS}; do
  wait ${PID}
  EXIT_STATUSES="${EXIT_STATUSES} $?"
done

for EXIT_STATUS in ${EXIT_STATUSES}; do
  if [ ${EXIT_STATUS} -gt 0 ] ; then
    exit 1
  fi
done
